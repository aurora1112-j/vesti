Hackathon：心迹·Vesti工程规格文档
00_Meta 顶层设计
项目定位： 一款 Local-First 的浏览器插件，自动捕获用户在多个 AI 聊天平台（ChatGPT / Claude / Gemini / DeepSeek）的对话记录，提供统一的时间轴回顾、全文检索和量化可视化面板。
一句话：一个在本地集成不同chatbot平台聊天记录并提供摘要&可视化回顾的中台（chrome浏览器插件）
MVP 范围确认：后端捕获仅支持 ChatGPT + Claude；Gemini / DeepSeek 仅保留前端按钮与占位展示，不接入解析/存储。
MoSCoW 优先级图例
在本文档中，每个功能点都附有以下优先级标记，用于指导开发顺序和取舍决策。
 
点击图片可查看完整电子表格
01_Product_Philosophy: 产品哲学
数字主权、记忆资产与去中心化信息中台
02_Tech_Stack: 技术选型
核心原则：这和memo chat同样是一套“Local-First”（本地优先）的架构。我们不依赖后端服务器，所有数据存储、检索、分析均在用户浏览器本地完成，确保绝对隐私与极速响应。
2.1 Extension Framework（基座框架）🔴 Must
选型：Plasmo
Plasmo 是浏览器插件领域的 "Next.js"，提供开箱即用的 React 支持、TypeScript 配置、热重载 (HMR) 以及自动化的 Manifest V3 适配。它解决了原生插件开发中配置繁琐、开发体验差的核心痛点。选择 Plasmo 意味着开发者可以专注于业务逻辑，而非和 Webpack + manifest.json 搏斗。
2.2 Frontend Core（前端核心）🔴 Must
 
点击图片可查看完整电子表格
工程不确定性备注： Zustand 在 Content Script ↔ Background 跨上下文通信时需要额外的 chrome.runtime.sendMessage 桥接层。MVP 阶段先用消息传递实现同步，后续若状态复杂度上升再引入 Zustand middleware。
2.3 UI & Styling（视觉与样式）🔴 Must
 
点击图片可查看完整电子表格
Shadow DOM 注意事项： 注入宿主页面的 Content Script 组件（胶囊悬浮条）必须封装在 Shadow DOM 中，防止宿主 CSS 污染。Tailwind 需要配置 important: true 或 prefix 以确保样式在 Shadow DOM 内生效，这是已知的集成难点，需在第一轮冲刺中提前验证。
2.4 Data & Storage（数据与存储）🔴 Must
 
点击图片可查看完整电子表格
容量预估： Chrome 的 IndexedDB 配额约为磁盘可用空间的 60%（通常数 GB 级），对本地对话存储而言远超需求。MVP 阶段无需担忧存储上限，但仍应在设置页展示已用空间以建立用户信任。
2.4.1 AI Insights（LLM 摘要/周报）🔴 Must
说明：接入 ModelScope 推理 API 生成摘要与周报。API Key 由用户本地保存（chrome.storage.local），仅发送 content_text 文本，默认中文输出。

2.5 Visualization（可视化）🟢 Could
 
点击图片可查看完整电子表格
降级策略： 如果时间不够，热力图和图表组件全部砍掉，仅保留纯数字 KPI 卡片。可视化层与数据层解耦，不影响核心功能。
2.6 Build & Tooling（构建与工具）🔴 Must
 
点击图片可查看完整电子表格
2.7 明确不做 ⚫ Won't
以下技术和能力在本次黑客松中明确排除，以控制范围：
•	后端服务器 / 云端同步： 纯 Local-First，不搭建任何后端。
•	多设备登录 / 账号系统： 不做用户认证。
•	Firefox / Safari 适配： 仅支持 Chromium 内核浏览器。
•	国际化 (i18n)： MVP 仅支持中文界面。

10_Core_Engine (内核架构)
设计理念
内核与 UI 完全解耦。无论 UI 是 SidePanel、Popup 还是 Tab，内核始终在后台（Content Script & Background Service Worker）稳定运行。它是一条精密的流水线：DOM（原材料）→ 解析器（加工）→ 中间件（质检）→ IndexedDB（入库）。

Plain Text
流程图
┌─────────────────────────────────────────────────────────┐
│  宿主页面 (ChatGPT / Claude / Gemini / DeepSeek)        │
│  ┌───────────────┐                                      │
│  │ MutationObserver (监听层) 🔴 Must                    │
│  └───────┬───────┘                                      │
│          │ DOM 变化事件 (debounced 2000ms)               │
│          ▼                                              │
│  ┌───────────────┐                                      │
│  │ Platform Parser (解析层) 🔴 Must                     │
│  │ IParser 接口 → 各平台实现                             │
│  └───────┬───────┘                                      │
│          │ 标准化 Conversation + Message[]               │
│          ▼                                              │
│  ┌───────────────┐                                      │
│  │ Middleware Pipeline (中间件) 🔴/🟡                    │
│  │ 1. Dedup    🔴 Must                                  │
│  │ 2. Noise    🟡 Should                                │
│  └───────┬───────┘                                      │
│          │ 清洗后的数据                                   │
│          ▼                                              │
│  ┌───────────────┐                                      │
│  │ Dexie.js → IndexedDB  🔴 Must                       │
│  └───────────────┘                                      │
└─────────────────────────────────────────────────────────┘
          │ chrome.runtime.sendMessage
          ▼
┌─────────────────────────────────────────────────────────┐
│  Background Service Worker                              │
│  Zustand Store ↔ SidePanel / Popup UI                   │
└─────────────────────────────────────────────────────────┘

MVP 说明：仅 ChatGPT + Claude 进入捕获与入库流程；Gemini / DeepSeek 保留前端按钮，不触发后端。

11_Data_Schema: 数据模型定义
我们将数据分为两层：会话 (Conversation) 和 消息 (Message)。这符合大多数 LLM 的数据结构，也方便进行统计。
11.1 Dexie Schema 定义 🔴 Must
TypeScript
// db.ts
import Dexie, { Table } from 'dexie';

export class MemoryHubDB extends Dexie {
  conversations!: Table<Conversation>;
  messages!: Table<Message>;

  constructor() {
    super('MemoryHubDB');
    this.version(1).stores({
      // 复合索引 [platform+created_at] 用于按平台+时间筛选
      conversations: '++id, platform, title, created_at, updated_at, uuid, [platform+created_at]',
      // 复合索引 [conversation_id+created_at] 用于按时间加载单条会话
      messages: '++id, conversation_id, role, created_at, [conversation_id+created_at]'
    });
  }
}

export const db = new MemoryHubDB();
11.2 Conversation 实体 🔴 Must
TypeScript
interface Conversation {
  id?: number;                // Dexie 自增主键
  uuid: string;               // 原始平台的 Session/Thread ID（用于去重和跳转原页面）
  platform: Platform;         // 来源平台
  title: string;              // 会话标题（AI 生成或取用户第一句话）
  snippet: string;            // 内容前 100 字预览（用于卡片展示，避免加载全量消息）
  url: string;                // 原始对话页面 URL（用于"跳转"功能）
  created_at: number;         // 首次捕获时间戳（ms）
  updated_at: number;         // 最后更新时间（用于排序和热力图统计）
  message_count: number;      // 消息总数（用于卡片上的轮数展示）
  is_archived: boolean;       // 是否已归档
  is_trash: boolean;          // 是否被智能降噪移入回收站 🟡 Should
  tags: string[];             // 用户手动标签 🟢 Could
  stat_tokens: number;        // 估算 Token 消耗量 🟢 Could
}

type Platform = 'ChatGPT' | 'Claude' | 'Gemini' | 'DeepSeek';
MVP 平台策略：ChatGPT/Claude 具备完整捕获与入库；Gemini/DeepSeek 仅 UI 占位（不接入后端）。
关键设计决策说明：
snippet 字段在写入时截取，而非在渲染时从 messages 中实时计算。这样列表页只需查 conversations 表即可完成渲染，避免了 N+1 查询问题。url 字段支持"跳转原页面"功能，从 Content Script 中的 window.location.href 采集。
is_trash 字段用于智能降噪模式的软删除。被过滤的对话不会真正消失，而是打上标记，不出现在主 Timeline 中，但用户可在"回收站"中找回。这是一个 Should-have 功能，如果时间紧迫，可以先硬删，后续再补回收站逻辑。
tags 和 stat_tokens 属于 Could-have，MVP 阶段可以在接口中保留字段定义但暂不实现写入逻辑。
11.3 Message 实体 🔴 Must
TypeScript
interface Message {
  id?: number;
  conversation_id: number;    // 外键，关联 Conversation.id
  role: 'user' | 'ai';       // MVP 阶段只需区分用户和 AI
  content_text: string;       // 纯文本内容（用于搜索）
  content_html: string;       // 原始 HTML（用于保留代码高亮、表格格式）🟡 Should
  content_markdown: string;   // 解析后的 Markdown（用于复制和导出）🟡 Should
  created_at: number;         // 消息时间戳
  meta?: MessageMeta;         // 扩展元数据 🟢 Could
}

interface MessageMeta {
  model_version?: string;     // e.g., "GPT-4o", "Claude-3.5-Sonnet"
  thinking_time?: number;     // 推理模型的思考耗时（秒）
}
MVP 降级策略： content_html 和 content_markdown 是 Should-have。如果时间紧迫，MVP 可以只保存 content_text（通过 element.innerText 提取），放弃富文本保留。这会导致代码块丢失格式，但核心的"保存-检索-回顾"链路不受影响。后续可通过 Turndown 库（HTML→Markdown 转换器）补上 Markdown 层。

12_Capture_Strategy: 捕获策略系统
这是一个 Pipeline (流水线) 架构。数据从 DOM 流向数据库，中间经过解析器和中间件的处理。
12.1 Observer Layer（监听层）🔴 Must
核心技术： MutationObserver
监听宿主页面特定容器（#root、main 或各平台对话容器的特定选择器）的 childList 和 characterData 变化。
防抖策略（关键）： AI 输出是流式的，每个 token 到达都会触发 DOM 变化。不能每变一个字符就启动解析管线。采用 2000ms 的静默阈值——当 DOM 停止变化超过 2 秒时，认为 AI 输出完毕，此时触发一次完整解析。
JavaScript
// observer.ts — 核心监听逻辑骨架
let debounceTimer: ReturnType<typeof setTimeout> | null = null;

const observer = new MutationObserver(() => {
  if (debounceTimer) clearTimeout(debounceTimer);
  debounceTimer = setTimeout(() => {
    // AI 输出静默 2 秒，触发解析管线
    pipeline.run();
  }, 2000);
});

// 在 Content Script 中启动
observer.observe(
  document.querySelector('#__next') || document.body, // 选择器因平台而异
  { childList: true, subtree: true, characterData: true }
);
工程风险： 各平台的 DOM 结构会随版本更新而变化，这是最大的不确定性来源。应对策略是将所有平台特定的 DOM 选择器集中在 Parser 层的"选择器映射表"中，便于快速修复。
12.2 Parser Layer（解析层 — 策略模式）🔴 Must
针对不同平台实现统一的 IParser 接口。每个 Parser 维护一套独立的 DOM 选择器映射表 (Selector Map)，平台 DOM 变更时只需更新对应 Parser，互不影响。
TypeScript
// parser.ts — 统一接口定义
interface IParser {
  /** 识别当前页面属于哪个平台，返回 null 表示不匹配 */
  detect(): Platform | null;
  /** 提取会话标题 */
  getConversationTitle(): string;
  /** 提取当前页面上所有可见消息 */
  getMessages(): ParsedMessage[];
  /** 判断 AI 是否正在输出（用于决定是否延迟解析） */
  isGenerating(): boolean;
  /** 获取会话的原始 UUID（用于去重） */
  getSessionUUID(): string;
}

interface ParsedMessage {
  role: 'user' | 'ai';
  textContent: string;
  htmlContent: string;     // 🟡 Should：MVP 可先忽略
  timestamp?: number;      // 部分平台可从 DOM 提取时间
}
MVP 交付范围： 首轮冲刺仅实现 ChatGPT + Claude Parser（完整捕获/入库）。Gemini / DeepSeek 仅保留前端按钮与状态标识，不接入解析/存储。后续扩展平台时继续沿用 IParser + Selector Map 的策略即可。每个 Parser 的选择器映射表示例如下：
TypeScript
// chatgpt-parser.ts — 选择器映射（示意，需根据实际 DOM 调整）
const SELECTORS = {
  conversationContainer: 'main .flex.flex-col',
  messageBlock: '[data-message-id]',
  userMessage: '[data-message-author-role="user"]',
  aiMessage: '[data-message-author-role="assistant"]',
  titleElement: 'nav .bg-token-sidebar-surface-secondary',
  generatingIndicator: '.result-streaming',
};

12.3 Middleware Pipeline（中间件流水线）🔴/🟡
在数据入库前经过一系列中间件处理。每个中间件是一个纯函数，接收数据并返回处理后的数据（或 null 表示丢弃）。
Middleware 1: Deduplication（去重）🔴 Must
检查 conversation.uuid 是否已存在于数据库。若存在，执行增量更新：比较 message_count，只写入新增的消息，并更新 updated_at。若不存在，创建新会话记录。这是保证数据一致性的底线，必须在第一轮冲刺中完成。
Middleware 2: Noise Filter（智能降噪）🟡 Should
降噪规则如下，作为 Should-have 功能实现。如果时间紧迫，可以先跳过，让所有对话全量入库（即默认"全量镜像模式"）。
•	短对话过滤： 对话轮数 < 3 轮的一次性问答。
•	关键词黑名单： 标题或内容包含 translate、翻译、polish、润色 等可配置关键词。
•	低信息量过滤： AI 回复总字数 < 50 字。
•	拒答模板过滤： 检测 "对不起，作为一个人工智能语言模型..." 等常见拒答开头。
被过滤的对话打上 is_trash: true 标记进入回收站，不直接丢弃。

13 State Machine（状态机设计）
为了支持多种捕获模式（全自动 / 策展人 / 隐私暂停）的无缝切换，采用有限状态机 (FSM) 管理录制行为。
13.1 状态定义
TypeScript
┌──────────────────────────────────────────────────┐
│                                                  │
│   ┌──────────┐    用户点击"开始"    ┌───────────┐│
│   │ STANDBY  │ ─────────────────→ │ RECORDING ││
│   │ (待机)    │ ←───────────────── │ (录制中)   ││
│   └──────────┘    用户点击"暂停"    └─────┬─────┘│
│        ▲                                 │      │
│        │         用户点击"隐私"           │      │
│        │    ┌──────────┐                 │      │
│        └─── │ PAUSED   │ ←──────────────┘      │
│             │ (隐私暂停) │                        │
│             └──────────┘                        │
│                                                  │
│   任意状态 → 用户点击"保存" → ARCHIVED (已归档)    │
└──────────────────────────────────────────────────┘

 
点击图片可查看完整电子表格
MVP 降级策略： 状态机的完整四态是 Should-have。MVP 最简方案是只实现 RECORDING（全自动保存，页面加载即录制），不做 STANDBY / PAUSED / ARCHIVED 的切换逻辑。这样等价于"全量镜像模式"一个挡位，所有策展人模式的交互后置。
13.2 捕获模式与状态机的映射
 
点击图片可查看完整电子表格
20_UI_Design_System (视觉层/前端风格)
21_Global_Styles: 字体、颜色、间距、阴影
Design 
22_Component_Library:
ConversationCard: 状态（Default, Hover, Expanded）。
MessageBubble: User/AI 样式区分。
HeatmapGrid: 统计图表组件。
30_Feature_Specs (功能业务层/UX 功能布局)
本章节定义连接内核数据 (Core Engine) 与用户感知的交互层，说明需要构建的个人 AI 记忆中台。
原插件元素拆解memo

31 Timeline Feed（资产流与检索）🔴 Must
这是用户打开插件后看到的第一个画面，承载"记忆资产"的核心浏览体验。
31.1 核心布局
采用 Sidebar + List Stream 架构。
•	右侧 Dock 栏（垂直导航）： 窄边栏，宽度约 48px，包含功能图标的垂直排列。上部放置 🏠 主页（对话流）、📊 仪表盘（统计）、🧠 灵感（AI 分析，预留入口）；底部放置 ⚙️ 设置 和存储状态圆环。
•	顶部状态栏： 极简的一行 Status Bar（高度 ≤ 32px），压缩展示总对话数和今日新增，取代原有喧宾夺主的大面积统计卡片。
•	中央列表流（Conversation Feed）： 核心交互区域，以 updated_at 倒序排列所有对话记录。
31.2 交互单元：对话卡片 (Conversation Card)
对话卡片是整个应用的"原子单元"，也是用户接触最频繁的组件。设计原则是渐进式披露 (Progressive Disclosure)——默认极简，交互时才展开细节。
默认静态展示（Always Visible）🔴 Must：
•	标题 (Title)： 自动生成的对话摘要，单行截断。
•	平台标签 (Platform Tag)： 带有特定背景色的胶囊标签（如 Gemini 绿色、Claude 橙色、ChatGPT 绿色、DeepSeek 蓝色）。MVP 中 Gemini/DeepSeek 仅作为 UI 标签/按钮占位。
•	时间戳 (Timestamp)： 相对时间显示（如"1 分钟前"、"3 小时前"），超过 7 天显示绝对日期。
Hover 渐进披露（On Hover）🔴 Must：
当鼠标悬停在卡片上时，展开以下额外信息和操作：
•	摘要 (Snippet)： 内容前 2-3 行预览，帮助快速识别上下文。
•	对话轮数 (Turn Count)： 气泡图标 + 数字。
•	操作栏 (Contextual Action Bar)： 卡片右上角浮现操作按钮——编辑标题（✏️）、跳转原页面（↗️）、删除（🗑️）。
关于 Hover Actions 的工程折中： 原始设计中操作图标直接浮现在右上角，容易误触。推荐的优化方案是将编辑和删除折叠进一个 ... (More Options) 菜单中，只保留"跳转原页面"作为直接操作（因为它不涉及数据变更）。但这是 Should-have 级别的交互优化，MVP 阶段直接浮现三个图标即可。
31.3 检索系统 🔴 Must
全局搜索框： 位于列表顶部，占位符提示"搜索对话标题或内容..."。支持对 conversations.title 和 messages.content_text 的模糊匹配。
MVP 实现方案：使用 Dexie 的 .filter() 配合 String.includes() 进行简单的子串匹配。对于数千条记录的规模，这已经足够快（< 100ms）。如果后续数据量增长到万级，再引入 MiniSearch 做倒排索引。
多维筛选器 🟡 Should：
点击搜索框右侧的漏斗图标展开筛选面板。
•	日期范围： 快捷预设（最近一周 / 最近一月）+ 自定义起止日期。
•	平台来源： 下拉选择，过滤特定 AI。
•	操作区： 应用筛选 + 清空筛选。
筛选器的 UI 降级策略： 理想方案是将筛选条件做成搜索框下方的 Chips（标签），点击 Chip 弹出下拉菜单，所见即所得。但 MVP 阶段使用弹窗 (Popover) 即可，Chips 方案作为 Could-have 后置。

32 Reader View（对话详情/阅读视图）🔴 Must
当用户点击列表中的卡片后进入此视图，用于深度阅读、回顾和信息提取。
32.1 视图逻辑与导航
导航方式 🔴 Must： 点击卡片后全页切换至详情视图。顶部 Sticky Header 包含返回箭头（←）、对话标题、平台标签、轮数和时间戳。
分栏视图（Side Sheet）🟢 Could： 理想方案是在宽屏下采用左侧列表 + 右侧详情的 Split View，避免频繁的"返回-点击-返回"。但这显著增加了布局复杂度，作为 Could-have 后置。
32.2 对话流设计
去边框化设计 🔴 Must： 移除每条消息的外边框和粗色条（原始设计的"框感"太重，阅读长文时视觉压力大）。改用留白和极淡的背景色区分角色：用户消息背景透明，AI 回答使用 bg-gray-50 浅灰背景。角色通过小头像或极简标签（缩小字号）区分，时间戳默认隐藏，Hover 时在消息右上角显示。
消息流布局： 垂直流式，按时间顺序排列。每条消息之间使用 16-24px 的间距自然分隔。
32.3 智能长文折叠 (Smart Truncation) 🔴 Must
当 AI 回复内容较长时，自动折叠以避免信息过载。
•	折叠阈值： 纯文本内容超过视口高度 60% 时触发折叠；代码块默认不折叠（代码通常需要完整查看）。
•	视觉表现： 折叠处上方添加一个 from-transparent to-white 的渐变遮罩，暗示下方还有内容。底部显示"展开全文 ↓"按钮。
•	交互： 点击按钮平滑展开（CSS max-height transition），支持再次收起。
MVP 降级： 智能区分代码块和文本的折叠策略是 Should-have。MVP 可以统一使用固定字符数（如 500 字）作为折叠阈值，不区分内容类型。
32.4 单条消息微交互 (Contextual Action Bar) 🟡 Should
再次应用渐进式披露。鼠标悬停在某一条消息上时，右上角浮现轻量工具栏：
•	复制文本 (Copy)： 一键复制该条消息的纯文本。
•	复制代码 (Copy Code)： 若消息包含代码块，自动提取并复制代码内容 🟢 Could。
•	分享 (Share)： 生成该条消息的截图或文本分享 🟢 Could。
MVP 最小实现： 只做"复制文本"一个按钮。复制代码和分享功能后置。

33 Dashboard Stats（量化自我面板）🟢 Could
定位： 替代原有的简陋计数器（总对话数 / 今日新增），构建 Quantified Self（量化自我）面板。整个模块为 Could-have，如果时间不够，回退到顶部 Status Bar 的纯数字展示即可。
33.1 核心资产概览 (Asset Overview)
3-4 个紧凑的 KPI 卡片，Grid 布局。
 
点击图片可查看完整电子表格
33.2 Contribution Heatmap（贡献热力图）🟢 Could
灵感来源于 GitHub 的 Contribution Graph。每个小方块代表一天，颜色越深代表当天与 AI 交互越频繁。这是最具视觉冲击力的组件，也是"极客型用户"最喜欢展示的"努力证明"。
技术实现：查询 conversations 表按 created_at 分组到每一天，统计每日对话数，然后用 CSS Grid 或 SVG 渲染 52×7 的色块矩阵。纯前端计算，无需额外依赖。
33.3 Platform Radar（平台偏好分析）🟢 Could
饼图或堆叠条形图，展示用户在不同平台的使用分布比例。数据来源：db.conversations.where('platform').equals(p).count()。可使用 Recharts 快速实现。
33.4 Topic Galaxy（话题词云）🟢 Could
对所有对话标题进行简单的分词（前端可用 Intl.Segmenter 或简单正则），提取高频关键词，以词云或气泡图形式展示。这个组件与未来的"灵感"功能衔接，但 MVP 阶段仅做静态展示，不接入 LLM 分析。

34 Settings Panel & Capsule Widget（设置面板 & 注入式组件）
此章节覆盖两个关联但独立的模块：插件自身的设置面板，以及注入到宿主页面的胶囊悬浮条。
34.1 设置面板 (Settings Panel) 🔴 Must (基础) / 🟡 Should (高级)
独立的模态窗口或侧滑页，管理插件的核心配置。
基础设置 🔴 Must：
•	捕获模式选择： 单选按钮组 (Radio Group)，三个选项：
￮	🔘 全量镜像（默认）：自动保存所有对话，无过滤。
￮	⚪ 智能降噪 🟡 Should：仅保存符合条件的对话。选中后展开过滤阈值设置（最小轮数、关键词黑名单）。
￮	⚪ 手动/按需归档 🟡 Should：默认不保存，用户手动触发"回溯保存"。选中后展示说明文案。
•	存储管理： 显示已用存储空间（进度条，如 300KB / 5GB）。
•	导出数据 🟡 Should： 导出为 JSON。Markdown 和 TXT 格式作为 Could-have。
•	清空数据： 危险操作，需二次确认。
关于 (About) 🔴 Must： 版本号、作者、项目链接。
支持平台状态 🟡 Should： 展示已适配的 AI 列表，以勾选状态标识（ChatGPT/Claude 已接入；Gemini/DeepSeek 按钮占位）。
MVP 降级： 设置页只保留"全量镜像"一个模式（不需要 Radio Group），加上存储信息和清空按钮。智能降噪和策展人模式的配置 UI 后置。
34.2 Capsule Widget（胶囊悬浮条 — 注入宿主页面）🔴 Must
这是插件在第三方网页（ChatGPT / Claude 等）上的"驻外大使"。设计目标：足够轻量、不遮挡聊天内容、清晰展示当前工作状态。
组件形态 🔴 Must：
•	容器： 深色背景胶囊 (rounded-full, bg-gray-900/90, backdrop-blur)，带微弱阴影。
•	状态指示器： 左侧 Logo + 呼吸灯圆点。
•	文本标签： 中间文字（如"自动保存中"）。
•	操作触发器： 右侧功能图标（如手动保存的软盘图标）。
状态自适应逻辑： 胶囊的颜色和文案根据当前状态机状态动态变化。
 
点击图片可查看完整电子表格
渐进式交互 🟡 Should：
•	自动收缩： 在"自动保存"状态下，默认只显示一个小圆形 Logo 图标（悬浮球），不显示文字。Hover 时横向展开为胶囊条，显示完整信息。
•	保存反馈动效： 保存成功时软盘图标变为 ✅，文字变为"已保存"，停留 2 秒后自动收缩。
•	拖拽定位 🟢 Could： 允许用户拖动胶囊位置（吸附屏幕边缘），防止遮挡输入框。
MVP 降级： 胶囊始终以展开态显示，不做收缩/展开动效。不做拖拽。状态仅反映 RECORDING 和保存成功两种。
34.3 技术实现备忘
•	Shadow DOM 🔴 Must： 胶囊组件必须封装在 Shadow DOM 中注入宿主页面，防止被 ChatGPT/Claude 的 CSS 污染（字体冲突、box-sizing 问题等）。这是 Plasmo 的 csui (Content Script UI) 特性可以辅助实现的。
•	Z-Index 管理 🔴 Must： 确保 z-index 足够高（建议 2147483646），但不覆盖全屏图片预览等原生组件。
•	性能约束 🔴 Must： 胶囊组件的渲染不应阻塞宿主页面。使用 requestAnimationFrame 或 React 的 startTransition 降低渲染优先级。

附录 A：MVP 冲刺检查清单
以下是按优先级排列的开发任务清单，用于进度管控。
第一轮冲刺（必须完成，产品可用的底线）🔴 Must
1.	Plasmo 项目脚手架搭建 — 配置 React + TypeScript + Tailwind + shadcn/ui。
2.	Dexie 数据库初始化 — conversations 和 messages 两张表，含索引。
3.	Content Script: MutationObserver + 防抖 — 在 ChatGPT/Claude 上验证 DOM 监听可用。
4.	ChatGPT + Claude Parser 实现 — 提取标题、消息列表、Session UUID。
5.	去重中间件 (Deduplication) — 基于 uuid 的增量更新逻辑。
6.	全量镜像模式 — 页面加载即自动录制，数据写入 IndexedDB。
7.	胶囊悬浮条（基础版） — Shadow DOM 注入，显示"自动保存中"静态状态。
8.	SidePanel: Timeline Feed — 对话卡片列表，按时间倒序，展示标题+平台标签+时间（Gemini/DeepSeek 仅按钮占位）。
9.	SidePanel: 全局搜索 — 基于 title 的子串搜索。
10.	SidePanel: Reader View（基础版） — 点击卡片进入详情，去边框化消息流。
11.	设置页（基础版） — 存储用量展示 + 清空数据按钮 + 关于信息 + 平台状态（ChatGPT/Claude 已接入；Gemini/DeepSeek 按钮占位）。
12.	AI Insights：ModelScope 配置 + 摘要/周报生成（Insights 页 + 设置页）。
第二轮冲刺（高优，显著提升体验）🟡 Should
13.	智能降噪中间件 + is_trash 回收站逻辑。
14.	筛选面板（日期 + 平台）。
15.	Hover 渐进披露： 卡片 Hover 展示摘要和操作栏。
16.	Reader View: 智能长文折叠 — 渐变遮罩 + 展开/收起。
17.	Reader View: 单条消息复制按钮。
18.	捕获模式 Radio Group — 设置页中配置全量/智能降噪/策展人。
19.	胶囊悬浮条自动收缩 + 保存反馈动效。
20.	导出为 JSON。
21.	策展人模式 + 状态机完整四态。
第三轮冲刺（锦上添花）🟢 Could
22.	Gemini / DeepSeek Parser（后续接入，当前仅前端按钮）。
23.	Dashboard: KPI 卡片 + Active Streak。
24.	Dashboard: Contribution Heatmap。
25.	Dashboard: Platform Radar 饼图。
26.	Dashboard: Topic Galaxy 词云。
27.	Reader View: 复制代码 / 分享功能。
28.	胶囊拖拽定位。
29.	筛选器 Chips 化。
30.	宽屏 Split View 布局。
31.	导出为 Markdown / TXT。
32.	Message 的 content_html / content_markdown 保存。
明确不做 ⚫ Won't
•	云端同步 / 多设备登录。
•	Firefox / Safari 适配。
•	国际化 (i18n)。
•	移动端适配。
附录 B：已知工程风险与缓解策略
 

